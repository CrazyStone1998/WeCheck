<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Test</title>
</head>
<body>
<a href="user.html">用户端应用</a><br>
<a href="management.html">管理端应用</a>

<h5>gaode</h5>
<p id="gaode"></p>
<h5>h5</h5>
<p id="h5"></p>
<h5>h5 watch</h5>
<p id="h5Watch"></p>

<script src="https://webapi.amap.com/maps?v=1.4.8&key=9aab6b6fff994d6e7d3f187cf5422fd6"></script>
<script>
    let gaode = document.getElementById('gaode')
    let h5 = document.getElementById('h5')
    let h5Watch = document.getElementById('h5Watch')


    function geo_success(position) {
        h5.innerHTML = `${new Date().getSeconds()} ${position.coords.latitude} ${position.coords.longitude} ${position.coords.accuracy}`
    }

    function geo_error() {
        h5.innerHTML = "Sorry, no position available."
    }


    setInterval(() => navigator.geolocation.getCurrentPosition(geo_success, geo_error), 1000)


    var wpid = navigator.geolocation.watchPosition(function (position) {
        h5Watch.innerHTML = `${new Date().getSeconds()} ${position.coords.latitude} ${position.coords.longitude} ${position.coords.accuracy}`
    }, function () {
        h5Watch.innerHTML = "Sorry, no position available."
    }, {
        enableHighAccuracy: true,
        maximumAge: 30000,
        timeout: 27000
    });


    var geolocation;
    AMap.plugin('AMap.Geolocation', function () {
        geolocation = new AMap.Geolocation({
            enableHighAccuracy: true,//是否使用高精度定位，默认:true
            GeoLocationFirst: true,
        });
        setInterval(() => {
            geolocation.getCurrentPosition();
        }, 1000)
        AMap.event.addListener(geolocation, 'complete', onComplete);//返回定位信息

        AMap.event.addListener(geolocation, 'error', onError)
    });

    //解析定位结果
    function onComplete(data) {
        gaode.innerHTML = `${new Date().getSeconds()} ${data.position.getLng()} ${data.position.getLat()} ${data.location_type} ${data.accuracy}`
    }

    function onError(data) {
        // 定位出错
        gaode.innerHTML = JSON.stringify(data)
    }
</script>
</body>
</html>